{"mappings":"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","sources":["src/App.vue","src/store/snapshots.js","src/scratchmoar.js","src/setup.js","src/styles/main.css.js","src/store/saving.js","src/store/loading.js","src/store/deleting.js"],"sourcesContent":["<template>\r\n<div ref=\"menu\" class=\"menu-bar_menu-bar-item_scratchmoar\">\r\n  <span @click=\"isVisible = !isVisible\">Scratchmoar</span>\r\n\r\n  <div :class=\"{scratchmoarHidden: !isVisible, scratchmoarPopup: true}\">\r\n    <div class=\"scratchmoarOverlay\" @click=\"isVisible = false\"></div>\r\n    <div class=\"scratchmoarPopupContent\">\r\n      <div class=\"scratchmoarPopupContentHeader\">\r\n        <h2>Scratchmoar Settings</h2>\r\n      </div>\r\n      <div class=\"scratchmoarPopupContentBody\">\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th width=\"40px\">ID</th>\r\n              <th width=\"100px\">Title</th>\r\n              <th width=\"100px\">Created</th>\r\n              <th>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"snapshot in snapshots\" :key=\"snapshot.id\" :class=\"{scratchmoarPositive: lastSnapshotID?.value === snapshot.id}\">\r\n              <td>{{ snapshot.id }}</td>\r\n              <!-- Display date in YY-MM-DD HH:MM format -->\r\n              <td>{{ snapshot.title }}</td>\r\n              <td>{{ new Date(snapshot.date).toLocaleString().slice(0, -2).replace(/:\\d{2}\\s/, ' ') }}</td>\r\n              <td>\r\n                <button title=\"Delete this snapshot\" class=\"scratchmoarNegative\" @click=\"deleteSnapshot(snapshot.id)\" style=\"margin-right: 2rem\">Delete</button>\r\n                <button title=\"Overwrite this snapshot with active project\" class=\"scratchmoarWarning\" @click=\"updateSnapshot(snapshot.id)\">Update</button>\r\n                <button title=\"Replace active project with this snapshot\" class=\"scratchmoarInfo\" @click=\"loadSnapshot(snapshot.id)\" style=\"float: right\">Load</button>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <div class=\"scratchmoarPopupContentFooter\">\r\n        <button title=\"Frees up all snapshots from the browser\" class=\"scratchmoarNegative\" @click=\"clearSnapshots()\" >Delete all snapshots</button>\r\n        <button title=\"Stores a new snapshot to the browser\" class=\"scratchmoarInfo\" @click=\"saveSnapshots()\" style=\"float: right\">Save new snapshot</button>\r\n        <button title=\"Downloads all snapshots as one file\" class=\"scratchmoarPositive\" @click=\"downloadSnapshots()\" style=\"float: right; margin-right: .5rem\">Download snapshots file</button>\r\n        <button title=\"Loads a snapshot file into the browser\" class=\"scratchmoarWarning\" @click=\"loadSnapshots()\" style=\"float: right; margin-right: .5rem\">Load snapshots file...</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, getCurrentInstance } from 'vue'\r\nimport Snapshots from './store/snapshots.js'\r\nimport { liveQuery } from 'dexie'\r\nimport { useObservable } from '@vueuse/rxjs'\r\n\r\nconst vm = getCurrentInstance()\r\nconst menu = ref(null)\r\nconst isVisible = ref(false)\r\nconst forceRenderer = ref(false) // For forcing a re-render\r\nlet snapshots = ref(useObservable(liveQuery(() => {\r\n  return Snapshots.snapshots.toArray()\r\n})))\r\n\r\n/**\r\n * Observe settings\r\n * Also sets lastSnapshotID\r\n */\r\nlet lastSnapshotID = ref(null)\r\nlet settings = ref(useObservable(liveQuery(async () => {\r\n  const data = await Snapshots.settings.toArray()\r\n  \r\n  // Find first {key: 'lastSnapshotID'} and set lastSnapshotID\r\n  if (data && data.length) {\r\n    lastSnapshotID = data.find(setting => {\r\n      if (setting.key === 'lastSnapshotID') {\r\n        vm.proxy.$forceUpdate()\r\n        return setting.value\r\n      }\r\n    })\r\n  }\r\n\r\n  return data\r\n})))\r\n\r\nonMounted(() => {\r\n  // Add matching classes for styling purposes\r\n  const $menuItem = document.querySelector('[class*=\"menu-bar_menu-bar-item_\"][class*=\"menu-bar_hoverable_\"]:not([class*=\"menu-bar_language-menu_\"])')\r\n  $menuItem.classList.forEach(className => menu.value.classList.add(className))\r\n\r\n  // Manually match list item styles\r\n  let styles = getComputedStyle(document.querySelector('[class*=\"gui_page-wrapper_\"] > [class*=\"menu-bar_menu-bar\"]'))\r\n  const $menuItems = document.querySelectorAll('.menu-bar_menu-bar-item_scratchmoar li')\r\n  $menuItems.forEach($menuItem => {\r\n    $menuItem.style.backgroundColor = styles.backgroundColor\r\n  })\r\n\r\n  // Listeners\r\n  document.addEventListener('scratchmoarLoadedProject', () => isVisible.value = false)\r\n})\r\n\r\n/**\r\n * Trigger a clear data event\r\n */\r\nfunction clearSnapshots () {\r\n  document.dispatchEvent(new CustomEvent('scratchmoarResetDB'))\r\n}\r\n\r\n/**\r\n * Trigger a save snapshot event\r\n */\r\nfunction saveSnapshots () {\r\n  document.dispatchEvent(new CustomEvent('scratchmoarSaveSnapshot'))\r\n  isVisible.value = false\r\n}\r\n\r\n/**\r\n * Trigger a load snapshot event\r\n */\r\nfunction loadSnapshot (id) {\r\n  document.dispatchEvent(new CustomEvent('scratchmoarLoadSnapshot', { detail: id }))\r\n}\r\n\r\n/**\r\n * Trigger a delete snapshot event\r\n */\r\nfunction deleteSnapshot (id) {\r\n  document.dispatchEvent(new CustomEvent('scratchmoarDeleteSnapshot', { detail: id }))\r\n}\r\n\r\n/**\r\n * Trigger an update snapshot event\r\n */\r\nfunction updateSnapshot (id) {\r\n  document.dispatchEvent(new CustomEvent('scratchmoarUpdateSnapshot', { detail: id }))\r\n  isVisible.value = false\r\n}\r\n\r\n/**\r\n * Trigger a download snapshots event\r\n */\r\nfunction downloadSnapshots () {\r\n  document.dispatchEvent(new CustomEvent('scratchmoarDownloadSnapshots'))\r\n  isVisible.value = false\r\n}\r\n\r\n/**\r\n * Trigger a load snapshots event\r\n */\r\nfunction loadSnapshots () {\r\n  document.dispatchEvent(new CustomEvent('scratchmoarLoadSnapshots'))\r\n  // isVisible.value = false\r\n}\r\n</script>\r\n","import Dexie from 'dexie'\r\nconst db = new Dexie('scratchmoar')\r\nexport default db\r\n\r\ndb.version(1).stores({\r\n  settings: '&key, value',\r\n  snapshots: '++id, parentId, date, title, description, *tags'\r\n})","import _SETUP from './setup.js'\r\nimport _SAVING from './store/saving.js'\r\nimport _LOADING from './store/loading.js'\r\nimport _DELETING from './store/deleting.js'\r\n\r\nimport {debounce} from 'lodash'\r\nconst DEBOUNCE_TIME = 250\r\n\r\n/**\r\n * Scrtachmoar extension\r\n * @todo Replace console.warning() and catch messages with Vue notifications\r\n */\r\nclass Scratchmoar {\r\n  constructor () {\r\n    // Constants\r\n    this.DEBOUNCE_TIME = DEBOUNCE_TIME\r\n    \r\n    // Prop\r\n    this.app = null // Vue app\r\n    this.vm = null // scratch-gui Virtual Machine\r\n    this.runtime = null // The Scratch Blocks extention runtime\r\n    this.db = null // IndexedDB Database\r\n    this.platform = null // Platform type (\"scratch\" for scratch.mit.edu, \"turbowarp\" assumes ?extension= support)\r\n    this.projectID = null // Project ID from URL\r\n    this.isLoading = false // Flag used to prevent autosave loops\r\n    this.isSaving = false // Flag used to prevent autosave loops\r\n\r\n    // Selectors\r\n    this.$selectors = {\r\n      projectTitle: 'input[class*=\"project-title-input_title-field_\"]',\r\n      menubarPortal: '[class*=\"menu-bar_account-info-group_\"]'\r\n    }\r\n  }\r\n  \r\n  // @fixme - This seemed like a good idea at first,\r\n  // but it can introduce bugs if method signatures change\r\n\r\n  // Setup\r\n  setup () {_SETUP.setup.call(this)}\r\n  scratchmoarNull () {return null}\r\n  getInfo () {return _SETUP.getInfo.call(this)}\r\n\r\n  // Saving\r\n  autosave = debounce(function () {_SAVING.autosave.call(this)}, this.DEBOUNCE_TIME, {leading: false, trailing: true})\r\n  saveSnapshot () {_SAVING.saveSnapshot.call(this)}\r\n  updateSnapshot (ev) {_SAVING.updateSnapshot.call(this, ev)}\r\n  async downloadSnapshots () {await _SAVING.downloadSnapshots.call(this)}\r\n\r\n  // Loading\r\n  loadSnapshot (ev) {_LOADING.loadSnapshot.call(this, ev)}\r\n  loadSnapshots () {_LOADING.loadSnapshots.call(this)}\r\n  loadAutosave () {_LOADING.loadAutosave.call(this)}\r\n\r\n  // Deleting\r\n  resetDB () {_DELETING.resetDB.call(this)}\r\n  deleteSnapshot (ev) {_DELETING.deleteSnapshot.call(this, ev)}\r\n\r\n  // Misc\r\n  setTitle (title = 'Untitled') {document.querySelector(this.$selectors.projectTitle).value = title}\r\n  getTitle (def = 'Untitled') {return document.querySelector(this.$selectors.projectTitle).value || def}\r\n  log () {console.log(...arguments)}\r\n}\r\n\r\n// Automatically add the extension if it's getting imported,\r\n// otherwise you'll have to manually run this yourself\r\nglobalThis.Scratch && Scratch.extensions.register(new Scratchmoar())\r\n\r\nexport default Scratchmoar","import App from './App.vue'\r\nimport Snapshots from './store/snapshots.js'\r\nimport $STYLES from './styles/main.css.js'\r\nimport {createApp} from 'vue'\r\nimport JSZip from 'jszip'\r\n\r\nexport default {\r\n  /**\r\n   * Setup the extension\r\n   */\r\n  setup () {\r\n    // resetDB if ?reset is present in URL and redirect to same URL without reset\r\n    if (window.location.search.includes('reset')) {\r\n      this.resetDB()\r\n      window.location = window.location.href.replace('?reset', '')\r\n    }\r\n\r\n    // Reference virtual machine\r\n    this.vm = globalThis.Scratch.vm\r\n    this.runtime = this.vm.runtime\r\n    this.db = Snapshots\r\n    globalThis.scratchmoar = this\r\n\r\n    // Mount Vue\r\n    this.app = createApp(App)\r\n    this.app.mount(this.$selectors.menubarPortal)\r\n    \r\n    // Manually add styles\r\n    const $styles = document.createElement('style')\r\n    $styles.innerHTML = $STYLES\r\n    document.querySelector('body').appendChild($styles)\r\n\r\n    // Determine the current project ID\r\n    let path = window.location.pathname\r\n    let parts = path.split('/')\r\n\r\n    // Determine platform\r\n    switch (window.location.host) {\r\n      case 'scratch.mit.edu':\r\n        this.platform = 'scratch'\r\n      break\r\n      case 'turbowarp.org':\r\n      default:\r\n        this.platform = 'turbowarp'\r\n    }\r\n\r\n    // @todo This should be added to db so that we can have multiple projects too!\r\n    // Scratch: /projects/ID\r\n    if (parts[1] === 'projects') {\r\n      this.projectID = parts[2]\r\n    // Turbowarp: /ID\r\n    } else if (Number.isInteger(+parts[1])) {\r\n      this.projectID = parts[2]\r\n    // Create new\r\n    } else {\r\n      this.projectID = 'autosave'\r\n    }\r\n    \r\n    // Custom event listeners\r\n    this.loadAutosave()\r\n    document.addEventListener('scratchmoarResetDB', this.resetDB.bind(this))\r\n    document.addEventListener('scratchmoarSaveSnapshot', this.saveSnapshot.bind(this))\r\n    document.addEventListener('scratchmoarLoadSnapshot', this.loadSnapshot.bind(this))\r\n    document.addEventListener('scratchmoarDeleteSnapshot', this.deleteSnapshot.bind(this))\r\n    document.addEventListener('scratchmoarUpdateSnapshot', this.updateSnapshot.bind(this))\r\n    document.addEventListener('scratchmoarDownloadSnapshots', this.downloadSnapshots.bind(this))\r\n    document.addEventListener('scratchmoarLoadSnapshots', this.loadSnapshots.bind(this))\r\n\r\n    document.addEventListener('scratchmoarLoadedProject', () => this.isLoading = false)\r\n    this.vm.on('PROJECT_CHANGED', () => this.autosave())\r\n\r\n    console.log('üß© Scratchmoar extension loaded!')\r\n  },\r\n  \r\n\r\n  /**\r\n   * Entry point for extension\r\n   */\r\n  getInfo () {\r\n    if (!this.vm) {\r\n      this.setup()\r\n    }\r\n\r\n    return {\r\n      id: 'scratchmoar',\r\n      name: 'Moooar',\r\n      blocks: [\r\n        {\r\n          opcode: 'scratchmoarNull',\r\n          blockType: Scratch.BlockType.REPORTER,\r\n          text: 'null'\r\n        }\r\n      ]\r\n    }\r\n  },\r\n}","/**\r\n * @fixme Running into issues getting CSS working with parcel so for now\r\n * doing it this way\r\n */\r\nexport default `\r\n.menu-bar_menu-bar-item_scratchmoar {\r\n  padding: 0 !important;\r\n}\r\n\r\n.menu-bar_menu-bar-item_scratchmoar > span {\r\n  padding: 0 0.75rem;\r\n  display: inline-block;\r\n  line-height: 2.5rem;\r\n}\r\n\r\n.scratchmoarHidden {\r\n  display: none;\r\n}\r\n\r\n.scratchmoarPopup {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n.scratchmoarPopup > .scratchmoarOverlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  height: 100%;\r\n  width: 100%;\r\n  background: rgba(0, 0, 0, 0.75);\r\n}\r\n\r\n.scratchmoarPopup > .scratchmoarPopupContent {\r\n  position: absolute;\r\n  cursor: initial;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  background: var(--ui-tertiary, #fff);\r\n  max-height: 80%;\r\n  border-radius: 0.5rem;\r\n  padding: 1rem;\r\n  width: 960px;\r\n  max-width: 100%;\r\n  overflow: auto;\r\n\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n.scratchmoarPopupContent {\r\n  color: #000;\r\n}\r\n[theme=\"dark\"] .scratchmoarPopupContent {\r\n  color: #fff;\r\n}\r\n\r\n.scratchmoarPopupContentBody {\r\n  padding-top: 2rem;\r\n  padding-bottom: 2rem;\r\n}\r\n\r\n.scratchmoarPopup button {\r\n  padding: 1rem;\r\n}\r\n\r\n.scratchmoarPopupContentBody select {\r\n  width: 100%;\r\n  display: block;\r\n}\r\n\r\n.scratchmoarPopupContentBody table {\r\n  width: 100%;\r\n  text-align: left;\r\n}\r\n\r\n.scratchmoarPopupContentBody table td,\r\n.scratchmoarPopupContentBody table th {\r\n  padding: 1em;\r\n  border: 1px solid #aaa;\r\n}\r\n.scratchmoarPopupContentBody table th {\r\n  background: #999a;\r\n}\r\n.scratchmoarPopupContentBody table tr:hover {\r\n  background: #eeea\r\n}\r\n\r\n.scratchmoarInfo {\r\n  background: #00a9;\r\n}\r\n.scratchmoarPositive {\r\n  background: #0a09;\r\n}\r\n.scratchmoarWarning {\r\n  background: #f809;\r\n}\r\n.scratchmoarNegative {\r\n  background: #f009;\r\n}\r\n`","import {exportDB} from 'dexie-export-import'\r\nimport JSZip from 'jszip'\r\n\r\nexport default {\r\n  /**\r\n   * Autosaves every few moments\r\n   */\r\n  autosave () {\r\n    if (this.isLoading || this.isSaving) return\r\n\r\n    const files = this.vm.saveProjectSb3DontZip()\r\n    this.isSaving = true\r\n    this.db.settings.put({key: 'autosave', value: {\r\n      title: this.getTitle(),\r\n      date: new Date(),\r\n      files\r\n    }}).finally(() => {\r\n      this.isSaving = false\r\n    })\r\n  },\r\n  \r\n  /**\r\n   * Save a snapshot\r\n   * - Take last autosave and recursively add each file/asset to zip\r\n   *  (we'll do this manually so we can use same loading mechanism)\r\n   * - Save zip to indexedDB\r\n   */\r\n  saveSnapshot () {\r\n    const zip = new JSZip()\r\n    const files = this.vm.saveProjectSb3DontZip()\r\n    this.isSaving = true\r\n\r\n    Object.keys(files).forEach(key => zip.file(key, files[key]))\r\n    zip.generateAsync({type: 'arraybuffer'}).then(data => {\r\n      this.db.snapshots.add({\r\n        title: this.getTitle(),\r\n        date: new Date(),\r\n        data\r\n      }).then(id => {\r\n        this.db.settings.put({key: 'lastSnapshotID', value: id}).catch(this.log)\r\n      })\r\n      .catch(this.log)\r\n      .finally(() => this.isSaving = false)\r\n    })\r\n  },\r\n \r\n  /**\r\n   * Update a snapshot\r\n   */\r\n  updateSnapshot (ev) {\r\n    const zip = new JSZip()\r\n    const files = this.vm.saveProjectSb3DontZip()\r\n    Object.keys(files).forEach(key => zip.file(key, files[key]))\r\n    this.db.settings.put({key: 'lastSnapshotID', value: ev.detail}).catch(this.log)\r\n\r\n    zip.generateAsync({type: 'arraybuffer'}).then(data => {\r\n      this.isSaving = true\r\n      this.db.snapshots.update(ev.detail, {\r\n        title: this.getTitle(),\r\n        updated: new Date(),\r\n        data\r\n      })\r\n        .then(() => this.autosave())\r\n        .catch(this.log)\r\n        .finally(() => this.isSaving = false)\r\n    }).catch(this.log)\r\n  },\r\n\r\n  /**\r\n   * Download snapshots\r\n   */\r\n  async downloadSnapshots () {\r\n    const blob = await exportDB(this.db)\r\n    const url = URL.createObjectURL(blob)\r\n    const a = document.createElement('a')\r\n    const title = this.getTitle()\r\n    const date = new Date().toISOString().split('T')\r\n    \r\n    a.href = url\r\n    a.download = `${date[0]}-${title}.json`\r\n    document.body.appendChild(a)\r\n    a.click()\r\n    document.body.removeChild(a)\r\n    URL.revokeObjectURL(url)\r\n  }\r\n}","import JSZip from 'jszip'\r\n\r\nexport default {\r\n  /**\r\n   * Load autosave\r\n   */\r\n  loadAutosave () {\r\n    if (this.isLoading || this.isSaving) return\r\n    \r\n    this.isLoading = true\r\n    this.db.settings.get({key: 'autosave'}).then(autosave => {\r\n      if (autosave.value) {\r\n        const zip = new JSZip()\r\n        Object.keys(autosave.value.files).forEach(key => zip.file(key, autosave.value.files[key]))\r\n\r\n        zip.generateAsync({type: 'arraybuffer'}).then(data => {\r\n          this.vm.loadProject(data).then(() => {\r\n            document.dispatchEvent(new CustomEvent('scratchmoarLoadedProject'))\r\n            this.setTitle(autosave.value.title)\r\n          })\r\n        })\r\n      }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * Load a snapshot\r\n   */\r\n  loadSnapshot (ev) {\r\n    this.db.snapshots.get(ev.detail).then(snapshot => {\r\n      this.isLoading = true\r\n      this.db.settings.put({key: 'lastSnapshotID', value: snapshot.id}).catch(this.log)\r\n      this.vm.loadProject(snapshot.data).then(() => {\r\n        document.dispatchEvent(new CustomEvent('scratchmoarLoadedProject'))\r\n        this.setTitle(snapshot.title)\r\n      })\r\n    }).catch(this.log)\r\n  },\r\n\r\n  /**\r\n   * Load snapshots\r\n   * @todo Needs better error catching\r\n   */\r\n  loadSnapshots () {\r\n    const $btn = document.createElement('input')\r\n    $btn.type = 'file'\r\n    $btn.accept = '.json'\r\n    $btn.style.display = 'none'\r\n\r\n    $btn.addEventListener('change', async () => {\r\n      const file = $btn.files[0]\r\n      this.db.import(file)\r\n        .then(() => {\r\n          // Load last snapshot\r\n          this.db.settings.get({key: 'lastSnapshotID'}).then(snapshot => {\r\n            this.loadSnapshot({detail: snapshot.value})\r\n          })\r\n        })\r\n        .catch(err => console.log('‚ö†Ô∏è Error importing:', err))\r\n      document.body.removeChild($btn)\r\n    })\r\n    document.body.appendChild($btn)\r\n    $btn.click()\r\n  }\r\n}","export default {\r\n  /**\r\n   * Reset the database\r\n   */\r\n  resetDB () {\r\n    this.db.settings.clear()\r\n    this.db.snapshots.clear()\r\n  },\r\n\r\n  /**\r\n   * Delete a snapshot\r\n   */\r\n  deleteSnapshot (ev) {\r\n    this.db.snapshots.delete(ev.detail)\r\n  }\r\n}"],"names":[],"version":3,"file":"scratchmoar.js.map"}